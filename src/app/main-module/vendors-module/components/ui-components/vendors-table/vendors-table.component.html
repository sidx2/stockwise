<div>
  <input
    appCustomInputStyle
    type="text"
    id="searchInput"
    placeholder="Search for vendor"
    (input)="search($event)"
  />
</div>

<div class="vendors_table">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Address</th>
        <th>Phone</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody
      *ngFor="let vendor of vendors | paginate: { itemsPerPage: psize, currentPage: currPage }; index as i"
    >
      <ng-container *ngIf="!isEditingVendor(vendor)">
        <tr *ngIf="vendor._id !== editingId; else editMode">
          <td>{{ vendor.name }}</td>
          <td>{{ vendor.email }}</td>
          <td>{{ vendor.address }}</td>
          <td>{{ vendor.phone }}</td>
          <td>
            <button appButtonPrimaryLight (click)="onEdit(vendor._id)">
              <mat-icon>edit</mat-icon>
            </button>

            <button appButtonPrimaryLight (click)="onDelete(vendor._id)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
      </ng-container>

      <ng-template #editMode>
        <tr class="pending" [formGroup]="editVendorForm">
          <td>
            <input
              appCustomInputStyle
              type="text"
              formControlName="name"
              [ngClass]="{ error: editVendorForm.get('name')?.invalid && editVendorForm.get('name')?.touched }"
              (ngModelChange)="onVendorChanged('name', $event)"
            />
            <div *ngIf="editVendorForm.get('name')?.invalid && editVendorForm.get('name')?.touched">
              <small class="text-danger">
                <span *ngIf="editVendorForm.get('name')?.hasError('minlength')">Must be at least 3 characters long.</span>
                <span *ngIf="editVendorForm.get('name')?.hasError('maxlength')">Cannot exceed 128 characters.</span>
              </small>
            </div>
          </td>
          <td>
            <input
              appCustomInputStyle
              type="text"
              formControlName="email"
              [ngClass]="{ error: editVendorForm.get('email')?.invalid && editVendorForm.get('email')?.touched }"
              (ngModelChange)="onVendorChanged('email', $event)"
            />
            <div *ngIf="editVendorForm.get('email')?.invalid && editVendorForm.get('email')?.touched">
              <small class="text-danger">
                <span *ngIf="editVendorForm.get('email')?.hasError('validEmail')">Please enter a valid email address.</span>
              </small>
            </div>
          </td>
          <td>
            <input
              appCustomInputStyle
              type="text"
              formControlName="address"
              [ngClass]="{ error: editVendorForm.get('address')?.invalid && editVendorForm.get('address')?.touched }"
              (ngModelChange)="onVendorChanged('address', $event)"
            />
            <div *ngIf="editVendorForm.get('address')?.invalid && editVendorForm.get('address')?.touched">
              <small class="text-danger">
                <span *ngIf="editVendorForm.get('address')?.hasError('minlength')">Must be at least 3 characters long.</span>
                <span *ngIf="editVendorForm.get('address')?.hasError('maxlength')">Cannot exceed 128 characters.</span>
              </small>
            </div>
          </td>
          <td>
            <input
              appCustomInputStyle
              type="text"
              formControlName="phone"
              [ngClass]="{ error: editVendorForm.get('phone')?.invalid && editVendorForm.get('phone')?.touched }"
              (ngModelChange)="onVendorChanged('phone', $event)"
            />
            <div *ngIf="editVendorForm.get('phone')?.invalid && editVendorForm.get('phone')?.touched">
              <small class="text-danger">
                <span *ngIf="editVendorForm.get('phone')?.hasError('validPhoneNumber')">
                  {{ editVendorForm.get('phone')?.getError('validPhoneNumber').message }}
                </span>
              </small>
            </div>
          </td>
          <td>
            <button appButtonPrimaryLight (click)="onCancel()">
              <mat-icon>cancel</mat-icon>
            </button>

            <button type="submit" appButtonPrimaryLight (click)="onDone()">
              <mat-icon>done</mat-icon>
            </button>
          </td>
        </tr>
      </ng-template>
    </tbody>
  </table>
</div>

<div class="paginationControls">
  <pagination-controls (pageChange)="currPage = $event"></pagination-controls>
</div>
